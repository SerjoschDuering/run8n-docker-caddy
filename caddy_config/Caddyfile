run8n.xyz {
    reverse_proxy n8n:5678 {
        flush_interval -1
    }
}

nocodb.run8n.xyz {
    reverse_proxy nocodb:8080
}

siyuan.run8n.xyz {
    reverse_proxy siyuan:6806 {
    }
}

supabase.run8n.xyz {
    reverse_proxy supabase_kong:8000
}

windmill.run8n.xyz {
    reverse_proxy windmill_server:8000
}

# Static Sites - Serve from /srv with security
sites.run8n.xyz {
    root * /srv

    # Block access to hidden files and sensitive directories
    @blocked {
        path /.git/* /.git* /.env* /.*
    }
    respond @blocked 404

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
        -Server
    }

    # Try files first, then directory listing
    file_server browse
}

# MCP Servers - Path-based routing
# Pattern: mcp.run8n.xyz/{name} â†’ {name}-mcp:3000
mcp.run8n.xyz {
    # SiYuan MCP Server
    handle /siyuan* {
        reverse_proxy siyuan-mcp:3000
    }

    # Add more MCP servers here as you deploy them
    # Example:
    # handle /notion* {
    #     reverse_proxy notion-mcp:3000
    # }

    # Root path - info page
    handle / {
        respond "MCP Gateway - Available servers: /siyuan" 200
    }

    # 404 for unknown paths
    handle {
        respond "MCP Server not found" 404
    }
}

# ===========================================
# DASHBOARD STACK - Homarr Auth Gateway
# ===========================================

# ONLY Homarr is publicly accessible - it's the auth gateway
# Netdata, Dozzle, Filebrowser are NOT publicly exposed
# Access them ONLY through Homarr after login
dashboard.run8n.xyz {
    reverse_proxy homarr:3000
}

