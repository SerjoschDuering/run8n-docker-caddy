run8n.xyz {
    reverse_proxy n8n:5678 {
        flush_interval -1
    }
}

nocodb.run8n.xyz {
    reverse_proxy nocodb:8080
}

siyuan.run8n.xyz {
    reverse_proxy siyuan:6806 {
    }
}

supabase.run8n.xyz {
    reverse_proxy supabase_kong:8000
}

windmill.run8n.xyz {
    reverse_proxy windmill_server:8000
}

# Static Sites - Serve from /srv with security
sites.run8n.xyz {
    root * /srv

    # Block access to hidden files and sensitive directories
    @blocked {
        path /.git/* /.git* /.env* /.*
    }
    respond @blocked 404

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
        -Server
    }

    # Try files first, then directory listing
    file_server browse
}

# Project subdomains (site1.sites.run8n.xyz â†’ /srv/site1/)
*.sites.run8n.xyz {
    map {host} {project} {
        ~^([^.]+)\.sites\.run8n\.xyz$ $1
    }
    root * /srv/{project}
    file_server
}

